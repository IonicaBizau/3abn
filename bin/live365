#!/usr/bin/env node

// Dependencies
var Live365 = require("../lib")
  , Clp = require("clp")
  , Package = require("../package")
  , Logger = require("bug-killer")
  , Diable = require("diable")
  ;

// Create options and add them
var radioOpt = new Clp.Option(["r", "radio"], "The radio name on live365.", "name")
  , daemonOpt = new  Clp.Option(["d", "daemon"], "If provided, the process will run in background.")
  , parser = new Clp({
        name: "Live365"
      , version: Package.version
      , process: true
      , exe: Package.name
      , examples: [
            "live365 -d -r mcfnetwork1 # my favorite radio, running as daemon"
        ]
      , docs_url: Package.homepage
    }, [
        radioOpt, daemonOpt
    ])
  ;

if (!radioOpt.is_provided) {
    return console.log(parser.displayHelp());
}

if (daemonOpt.is_provided && !Diable.isDaemon()) {
  Diable({exit: false});
  return setTimeout(process.exit, 1000);
}

var pl = Live365(radioOpt.value, { autoplay: true });
pl.on("playing", console.log);
pl.on("playend", console.log);
pl.on("error", console.log);
